@page "/"
@using Microsoft.AspNetCore.SignalR.Client

<h1>Hello, world!</h1>

Welcome to your new app.

<button @onclick="ConnectAsync">Connect</button>

@code{
    private HubConnection _hubConnection;

    protected async override Task OnInitializedAsync()
    {
        try
        {
            _hubConnection = new HubConnectionBuilder()
            .WithUrl("http://localhost:5178/chathub")
            .Build();

            _hubConnection.On<string, string>("ReceiveMessage", (user, message) =>
            {
                // Handle the received message
            });
            await ConnectAsync();
        }
        catch (Exception e)
        {
            
            throw;
        }
        
        await base.OnInitializedAsync();
    }

    public async Task ConnectAsync()
    {
        await _hubConnection.StartAsync();
    
    
    }

    public async Task SendMessageAsync(string user, string message)
    {
        await _hubConnection.InvokeAsync("SendMessage", user, message);
    }
}